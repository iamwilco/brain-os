{
  "version": "3.0.0",
  "updated": "2026-02-17",
  "source": "docs/STRATEGIC_ROADMAP.md",
  "phases": {
    "P0": { "name": "Foundation (Complete)", "description": "Scaffold, ingestion, indexing, extraction, search, agents, frontend, autonomy", "status": "completed" },
    "P1": { "name": "Wire Up", "description": "Make the system real — LLM integration, real embeddings, connect frontend, file watcher", "status": "active", "target": "2026-03-03" },
    "P2": { "name": "Orchestrator + Workshop", "description": "Central routing, structured memory, workshop v1, model routing, skills registry", "status": "planned", "target": "2026-03-24" },
    "P3": { "name": "Cortex + Auto-Improvement", "description": "Meta-agent, non-blocking execution, memory graph, circuit breakers", "status": "planned", "target": "2026-04-21" },
    "P4": { "name": "Polish + Ecosystem", "description": "Obsidian plugin, knowledge graph viz, E2E tests, security", "status": "planned", "target": "2026-05-19" }
  },
  "completed_history": {
    "note": "Tasks TASK-001 to TASK-050 (M0-M8) and TASK-100 to TASK-500 (M1-M4 vNext) are all completed. See tasks_vNext.json and git history for full details.",
    "total_completed": 72
  },
  "tasks": [
    {
      "id": "P1-001",
      "phase": "P1",
      "priority": 1,
      "status": "pending",
      "title": "Wire real LLM provider to agent loop",
      "description": "Connect Claude API to the execute stage of the agent loop. Replace mock LLM calls with actual API integration. Support streaming responses via SSE.",
      "acceptance_criteria": [
        "Claude API called from execute.ts with real API key",
        "Streaming responses delivered to client via SSE",
        "Error handling for rate limits, timeouts, invalid keys",
        "ANTHROPIC_API_KEY read from env (never hardcoded)",
        "Graceful fallback message if no API key configured"
      ],
      "file_targets": ["src/src/llm/provider.ts", "src/src/agent/loop/execute.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": []
    },
    {
      "id": "P1-002",
      "phase": "P1",
      "priority": 2,
      "status": "pending",
      "title": "Wire frontend to backend API",
      "description": "Connect React hooks to real Fastify API endpoints. Replace all mock data in pages with live API calls. Ensure projects, agents, sources, and search pages work end-to-end.",
      "acceptance_criteria": [
        "Dashboard fetches real project/agent counts from API",
        "Projects page lists real projects from backend",
        "Agents page shows agents from filesystem scan",
        "Sources page lists indexed sources from SQLite",
        "Search page performs real FTS5 queries",
        "Error states and loading states handled"
      ],
      "file_targets": ["frontend/src/hooks/", "frontend/src/pages/"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": []
    },
    {
      "id": "P1-003",
      "phase": "P1",
      "priority": 3,
      "status": "pending",
      "title": "Add real embedding provider",
      "description": "Replace MockEmbeddingProvider with a real local embedding model using @xenova/transformers (runs locally, no API key). Update vector search to use real embeddings.",
      "acceptance_criteria": [
        "Real embeddings generated via @xenova/transformers or similar",
        "Embedding dimension matches vector search expectations",
        "Model downloaded and cached locally on first use",
        "vector.ts and hybrid.ts work with real embeddings",
        "Fallback to mock if model load fails"
      ],
      "file_targets": ["src/src/search/vector.ts", "src/src/search/embeddings.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": []
    },
    {
      "id": "P1-004",
      "phase": "P1",
      "priority": 4,
      "status": "pending",
      "title": "Upgrade hybrid search to use Reciprocal Rank Fusion",
      "description": "Replace the simple weighted average in hybrid.ts with RRF scoring (like Spacebot). RRF merges FTS5 and vector results by reciprocal rank rather than raw scores.",
      "acceptance_criteria": [
        "RRF formula: score = sum(1 / (k + rank_i)) across result sets",
        "Configurable k parameter (default: 60)",
        "Results from FTS5 and vector search merged correctly",
        "Tests updated to verify RRF scoring",
        "Existing hybrid search API unchanged"
      ],
      "file_targets": ["src/src/search/hybrid.ts", "src/src/search/hybrid.test.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P1-003"]
    },
    {
      "id": "P1-005",
      "phase": "P1",
      "priority": 5,
      "status": "pending",
      "title": "Add file watcher for auto-reindex",
      "description": "Use chokidar to watch the vault for file changes and trigger incremental re-indexing automatically. Debounce rapid changes.",
      "acceptance_criteria": [
        "chokidar watches configured vault paths",
        "File add/change triggers incremental index update",
        "File delete removes entries from index",
        "Debounce of 2 seconds to batch rapid changes",
        "Watcher starts with server, stops on shutdown"
      ],
      "file_targets": ["src/src/server/watcher.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": []
    },
    {
      "id": "P1-006",
      "phase": "P1",
      "priority": 6,
      "status": "pending",
      "title": "Expose agent-to-agent tools for LLM",
      "description": "Create agent_list, agent_send, and agent_ask as LLM-callable tools in the agent loop. These enable multi-agent collaboration from within conversations.",
      "acceptance_criteria": [
        "agent_list tool returns available agents with metadata",
        "agent_send sends async message to another agent",
        "agent_ask sends request and waits for response (sync delegation)",
        "Tools registered in tool definitions for execute stage",
        "Scope enforcement: only Admin can use agent_ask by default"
      ],
      "file_targets": ["src/src/agent/tools/agent-tools.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": []
    },
    {
      "id": "P1-007",
      "phase": "P1",
      "priority": 7,
      "status": "pending",
      "title": "Add .env.example and configuration docs",
      "description": "Create .env.example with all required and optional env vars documented. Update README or docs with setup instructions for API keys.",
      "acceptance_criteria": [
        ".env.example lists all env vars with descriptions",
        "ANTHROPIC_API_KEY, VAULT_PATH, PORT documented",
        "Optional vars for embedding model, log level documented",
        "Setup instructions in docs or README"
      ],
      "file_targets": [".env.example", "docs/SETUP.md"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": []
    },
    {
      "id": "P2-001",
      "phase": "P2",
      "priority": 8,
      "status": "pending",
      "title": "Implement orchestrator agent routing",
      "description": "Create a central orchestrator in the Admin agent that routes incoming requests to the appropriate project agent based on context analysis. The orchestrator classifies intent and delegates.",
      "acceptance_criteria": [
        "Admin agent acts as orchestrator when no specific project targeted",
        "Intent classification determines which project agent handles request",
        "Context from request analyzed to select agent",
        "Fallback to Admin if no project match",
        "Routing decisions logged"
      ],
      "file_targets": ["src/src/agent/orchestrator.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P1-001", "P1-006"]
    },
    {
      "id": "P2-002",
      "phase": "P2",
      "priority": 9,
      "status": "pending",
      "title": "Implement structured memory store",
      "description": "Add memory.json as structured backing store for MEMORY.md. Each memory entry has: id, type (fact/decision/preference/goal/todo/event/observation), importance score, timestamps, and graph edges (relatesTo, updates, contradicts).",
      "acceptance_criteria": [
        "memory.json schema defined with Zod",
        "Memory types: fact, decision, preference, goal, todo, event, observation",
        "Importance score (0-1) with decay over time",
        "Graph edges between memory entries",
        "MEMORY.md auto-generated from memory.json for human readability",
        "Read/write functions with validation"
      ],
      "file_targets": ["src/src/agent/memory-store.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": []
    },
    {
      "id": "P2-003",
      "phase": "P2",
      "priority": 10,
      "status": "pending",
      "title": "Build Workshop v1 — connect canvas to real agents",
      "description": "Connect the Workshop UI to real backend agent chat. When entering a workshop, load the project agent with its knowledge context. Skills panel launches skill agents. Canvas renders artifacts from skill executions.",
      "acceptance_criteria": [
        "Workshop loads project context pack on entry",
        "Agent chat sends messages to real project agent via API",
        "Skills panel lists available skills from registry",
        "Skill execution results rendered as artifacts on canvas",
        "Session maintained across interactions"
      ],
      "file_targets": ["frontend/src/components/Workshop/", "frontend/src/pages/WorkshopPage.tsx"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P1-001", "P1-002"]
    },
    {
      "id": "P2-004",
      "phase": "P2",
      "priority": 11,
      "status": "pending",
      "title": "Add model routing by task type",
      "description": "Implement a model routing layer that selects the appropriate LLM based on task type. Chat gets best model, extraction gets structured model, compaction gets cheapest model.",
      "acceptance_criteria": [
        "ModelRouter interface with route(taskType) method",
        "Task types: chat, extract, compact, embed, branch",
        "Configurable model per task type in config",
        "Fallback chain if primary model fails (429/502)",
        "Routing decisions logged"
      ],
      "file_targets": ["src/src/llm/router.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P1-001"]
    },
    {
      "id": "P2-005",
      "phase": "P2",
      "priority": 12,
      "status": "pending",
      "title": "Create skills registry with discovery",
      "description": "Create a skills.json registry that catalogs all available skills with metadata. Admin agent can discover skills by searching the registry. Skills declare their tool requirements.",
      "acceptance_criteria": [
        "skills.json generated from agents/skills/ directory scan",
        "Each skill has: name, description, capabilities, version, toolRequirements",
        "API endpoint GET /api/skills returns registry",
        "Agent can search skills by capability",
        "Registry refreshed on file change"
      ],
      "file_targets": ["src/src/agent/skills-registry.ts", "agents/skills/registry.json"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": []
    },
    {
      "id": "P3-001",
      "phase": "P3",
      "priority": 13,
      "status": "pending",
      "title": "Implement Brain Cortex (meta-agent)",
      "description": "Create a Cortex meta-agent that runs on schedule (daily). It scans all agent memories for patterns, contradictions, and stale entries. Generates a knowledge bulletin injected into Admin prompt.",
      "acceptance_criteria": [
        "Cortex runs as scheduled agent (daily cron)",
        "Scans all MEMORY.md / memory.json across agents",
        "Detects contradictions, duplicates, stale entries",
        "Generates knowledge bulletin markdown",
        "Bulletin injected into Admin agent context",
        "Health report: failed runs, error patterns"
      ],
      "file_targets": ["src/src/agent/cortex.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P2-001", "P2-002"]
    },
    {
      "id": "P3-002",
      "phase": "P3",
      "priority": 14,
      "status": "pending",
      "title": "Add non-blocking execution with branches",
      "description": "Implement branch mechanism that forks agent context for long-running tasks. Channel remains responsive while branch thinks. Results delivered via WebSocket.",
      "acceptance_criteria": [
        "Branch forks from current agent context",
        "Channel returns immediate acknowledgment",
        "Branch executes independently, returns conclusion",
        "Results pushed to client via WebSocket event",
        "Multiple branches can run concurrently",
        "Branch timeout with cleanup"
      ],
      "file_targets": ["src/src/agent/branch.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P1-001"]
    },
    {
      "id": "P3-003",
      "phase": "P3",
      "priority": 15,
      "status": "pending",
      "title": "Implement memory graph with edges and decay",
      "description": "Extend structured memory store with graph edges (RelatedTo, Updates, Contradicts, CausedBy, PartOf) and importance decay. Add graph traversal queries.",
      "acceptance_criteria": [
        "Edge types: relatesTo, updates, contradicts, causedBy, partOf",
        "Importance decay based on last-accessed time",
        "Identity memories exempt from decay",
        "Graph traversal: given memory, find related N hops",
        "Duplicate detection and merge suggestions",
        "Pruning: remove memories below importance threshold"
      ],
      "file_targets": ["src/src/agent/memory-graph.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P2-002"]
    },
    {
      "id": "P3-004",
      "phase": "P3",
      "priority": 16,
      "status": "pending",
      "title": "Add circuit breakers to scheduled jobs",
      "description": "Enhance scheduler with circuit breaker pattern. Auto-disable jobs after N consecutive failures. Add health monitoring and alerting.",
      "acceptance_criteria": [
        "Circuit breaker trips after 3 consecutive failures (configurable)",
        "Tripped jobs skip execution until manually reset or cooldown expires",
        "Cooldown period configurable (default: 1 hour)",
        "Health status exposed via API: healthy/degraded/tripped",
        "Event emitted on circuit trip/reset"
      ],
      "file_targets": ["src/src/agent/scheduler.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": []
    },
    {
      "id": "P3-005",
      "phase": "P3",
      "priority": 17,
      "status": "pending",
      "title": "Build auto-improvement scanning agent",
      "description": "Create a meta-agent that periodically scans for new tools, models, and frameworks relevant to Brain. Suggests skill upgrades and configuration changes.",
      "acceptance_criteria": [
        "Agent runs weekly on schedule",
        "Scans configured sources (GitHub trending, npm, changelog feeds)",
        "Evaluates relevance to current skill set",
        "Generates upgrade suggestions as memory entries",
        "Human approval required before any changes applied"
      ],
      "file_targets": ["src/src/agent/auto-improve.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P3-001"]
    },
    {
      "id": "P4-001",
      "phase": "P4",
      "priority": 18,
      "status": "pending",
      "title": "Create Obsidian plugin for Brain integration",
      "description": "Build an Obsidian plugin that provides two-way sync between Obsidian and Brain. Trigger extraction from Obsidian, view knowledge items, search from sidebar.",
      "acceptance_criteria": [
        "Obsidian plugin skeleton with manifest.json",
        "Command: Trigger Brain extraction on current file",
        "Sidebar view: Search Brain knowledge base",
        "Status bar: Brain connection status",
        "Settings: API URL, auto-sync toggle"
      ],
      "file_targets": ["obsidian-plugin/"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P1-002"]
    },
    {
      "id": "P4-002",
      "phase": "P4",
      "priority": 19,
      "status": "pending",
      "title": "Add knowledge graph visualization",
      "description": "Build an interactive knowledge graph view using D3.js or Cytoscape. Show entities, relations, and memory connections. Clickable nodes navigate to source.",
      "acceptance_criteria": [
        "Force-directed graph layout",
        "Nodes = entities/memories, edges = relations",
        "Node size by importance/connection count",
        "Click node to view details or navigate to source",
        "Filter by type, project, date range",
        "Responsive and performant for 500+ nodes"
      ],
      "file_targets": ["frontend/src/components/KnowledgeGraph/"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P2-002"]
    },
    {
      "id": "P4-003",
      "phase": "P4",
      "priority": 20,
      "status": "pending",
      "title": "Add E2E tests with Playwright",
      "description": "Set up Playwright for end-to-end testing. Cover critical user flows: project creation, file upload, extraction, search, agent chat.",
      "acceptance_criteria": [
        "Playwright configured with test fixtures",
        "Test: Create project, upload file, verify indexed",
        "Test: Search returns relevant results",
        "Test: Agent chat sends/receives messages",
        "CI-compatible (headless mode)",
        "Test report generated"
      ],
      "file_targets": ["e2e/"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": ["P1-001", "P1-002"]
    },
    {
      "id": "P4-004",
      "phase": "P4",
      "priority": 21,
      "status": "pending",
      "title": "Security hardening — tool execution sandboxing",
      "description": "Add security boundaries for agent tool execution. Implement permission model for file access, shell commands, and network requests.",
      "acceptance_criteria": [
        "Tool execution runs within defined scope boundaries",
        "File tools cannot access outside agent scope",
        "Shell tool disabled by default, opt-in per agent",
        "Network requests logged and rate-limited",
        "Security violations logged with full context"
      ],
      "file_targets": ["src/src/agent/security.ts"],
      "created": "2026-02-17",
      "completed": null,
      "blocked_by": []
    }
  ]
}